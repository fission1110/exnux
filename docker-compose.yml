services:
  exnux:
    container_name: "exnux"
    build: "."
    cap_add:
      - SYS_PTRACE # Required for strace
      - NET_ADMIN # for WireShark
    privileged: true # required for network access
    stdin_open: true # -i
    tty: true # -t
    network_mode: "host" # YOLO. Network is not isolated.
    environment:
      LC_ALL: "C.UTF-8"
      LANG: "C.UTF-8"
      DISPLAY: "${DISPLAY}" # X11
      XAUTHORITY: "${XAUTHORITY}" # X11
      _JAVA_OPTIONS: "${_JAVA_OPTIONS}" # for JAVA scaling issues (_JAVA_OPTIONS="-Dsun.java2d.uiScale=2.0" in .env to scale UI)

    volumes:
      # Mount x11 and docker socket
      - "${XAUTHORITY}:/home/${USERNAME}/.Xauthority"
      - "/tmp/.X11-unix:/tmp/.X11-unix:rw"
      - "/var/run/docker.sock:/var/run/docker.sock"

      # Mount home directory
      - "/:/home/${USERNAME}/root"
      - "${HOME}:/home/${USERNAME}/home"
      - "${HOME}/.ssh:/home/${USERNAME}/.ssh"
      - "${HOME}/Downloads:/home/${USERNAME}/Downloads"
      - "${HOME}/Documents:/home/${USERNAME}/Documents"
      - "${HOME}/Pictures:/home/${USERNAME}/Pictures"

      # Mount command history
      - "./cache/.zsh_history:/home/${USERNAME}/.zsh_history"
      - "./cache/.bash_history:/home/${USERNAME}/.bash_history"
      - "./cache/.gdb_history:/home/${USERNAME}/.gdb_history"
      - "./cache/.cache/radare2/history:/home/${USERNAME}/.cache/radare2/history"
      - "./cache/.msf4/history:/home/${USERNAME}/.msf4/history"
      - "./cache/swp:/home/${USERNAME}/.cache/swp"

      # Mount other directories
      - "./cache/mytags:/home/${USERNAME}/.config/nvim/ctags/mytags"
      - "./cache/.config/github-copilot/hosts.json:/home/${USERNAME}/.config/github-copilot/hosts.json"
      - "./cache/.config/google-chrome:/home/${USERNAME}/.config/google-chrome"
      - "./cache/treesitter/parser:/home/${USERNAME}/.config/nvim/bundle/nvim-treesitter/parser/"
      - "./cache/treesitter/parser-info:/home/${USERNAME}/.config/nvim/bundle/nvim-treesitter/parser-info/"
    devices:
      - "/dev/dri" # GPU
      - "/dev/snd" # Sound
      - "/dev/video0:/dev/video0" # Webcam
    command: "/bin/bash"
  msf-postgres:
    container_name: "msf-postgres"
    network_mode: "host"
    environment:
      POSTGRES_USER: "msf"
      POSTGRES_PASSWORD: "msf"
    volumes:
      - "msf-postgres-pgdata:/var/lib/postgresql/data"
    image: "postgres:14.2"
  apt-cacher-ng:
    container_name: "apt-cacher-ng"
    image: "sameersbn/apt-cacher-ng:3.3-20200524"
    volumes:
      - "/srv/docker/apt-cacher-ng:/var/cache/apt-cacher-ng"
    ports:
      - "172.17.0.1:3142:3142"

volumes:
  msf-postgres-pgdata:

